<!DOCTYPE html>
<html lang="en-US">

<head>

<title>Interval Analyzer</title>

<link rel="stylesheet" type="text/css" href="../css/normalize.css">
<link rel="stylesheet" type="text/css" href="../css/site.css">

<meta charset="UTF-8">
<meta name="description" content="Map of locations in which the user has logged Strava activities">
<meta name="keywords" content="location summary">
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />

<link rel="shortcut icon" href="../images/favicon.ico" >

</head>

<body>

<style type="text/css">
    html { height: 100% }
    body { height: 100%; margin: 0; padding: 0 }
    div { margin: 0px }

    div.bar
    {
        display: inline-block;
        width: 20px;
        height: 75px;	/* Gets overriden by D3-assigned height below */
        background-color: teal;
    }

    path
    {
        stroke: steelblue;
        stroke-width: 2;
        fill: none;
    }

    .axis path,
    .axis line
    {
        fill: none;
        stroke: #000;
        stroke-width: 1;
        shape-rendering: crispEdges;
    }
</style>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.js" integrity="sha256-DZAnKJ/6XZ9si04Hgrsxu/8s717jcIzLy3oi35EouyE=" crossorigin="anonymous"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" integrity="sha256-KM512VNnjElC30ehFwehXjx1YCHPiQkOPmqnrWtpccM=" crossorigin="anonymous"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js" integrity="sha256-dsOXGNHAo/syFnazt+KTBsCQeRmlcW1XKL0bCK4Baec=" crossorigin="anonymous"></script>

<script>

function draw_graph(data, title, units, color)
{
    if (data.length <= 1)
    {
        return;
    }

    // Need to zero out the first and last points or else the fill will look silly.
    data[0].value = 0.0;
    data[data.length-1].value = 0.0;

    var Tooltip = d3.select("#charts")
        .append("div")
            .style("opacity", 0)
            .style("position", "absolute")
            .style("visibility", "hidden")
            .style("background-color", "white")
            .style("z-index", 1)
            .style("cursor", "pointer")
    var mouseover = function() {
        Tooltip
            .style("opacity", 0.7)
            .style("visibility", "visible")
    }
    var mousemove = function() {
        let coordinates = d3.mouse(this);
        let x = coordinates[0];

        Tooltip
            .html("<b>" + data[x].value.toFixed(2) + " " + units + "</b>")
            .style("top", (event.pageY)+"px")
            .style("left",(event.pageX)+"px")
    }
    var mouseleave = function() {
    }

    let margin = { top: 20, right: 20, bottom: 20, left: 50 },
        width = $("#charts").width() - margin.left - margin.right,
        height = 250 - margin.top - margin.bottom;

    let x = d3.time.scale().range([0, width]);
    let y = d3.scale.linear().range([height, 0]);

    let xAxis = d3.svg.axis().scale(x).orient("bottom");
    let yAxis = d3.svg.axis().scale(y).orient("left").ticks(5);

    let valueline = d3.svg.line()
        .x(function(d) { return x(d.date); })
        .y(function(d) { return y(d.value); });

    let svg = d3.select("#charts")
        .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .on('mouseover', mousemove)
            .on('mousemove', mouseover)
            .on('mouseleave', mouseleave)
        .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    x.domain(d3.extent(data, function(d) { return d.date; }));
    y.domain(d3.extent(data, function(d) { return d.value; }));

    svg.append("path")
        .attr("class", "line")
        .attr("d", valueline(data))
        .style("fill", color)
        .style("stroke", "LightSlateGray")
        .style("stroke-width", 1.25);
    svg.append("g")
        .attr("class", "x axis")
        .attr("transform", "translate(0," + height + ")")
        .call(xAxis);
    svg.append("g")
        .attr("class", "y axis")
        .call(yAxis)
        .append("text")
        .attr("transform", "rotate(-90)")
        .attr("y", 6)
        .attr("dy", ".71em")
        .style("text-anchor", "end")
        .text(title);
}

function draw_bar_chart(data, title, color)
{
    let xVals = Array.apply(null, Array(data.length - 1)).map(function (x, i) { return i + 1; } );

    let margin = {top: 20, right: 20, bottom: 55, left: 50},
        width = $("#charts").width() - margin.left - margin.right,
        height = 250 - margin.top - margin.bottom;

    let x = d3.scale.ordinal().domain(xVals).rangeBands([0, width]);
    let y = d3.scale.linear().domain([0, d3.max(data)]).range([height, 0]);

    let xAxis = d3.svg.axis().scale(x).orient("bottom");
    let yAxis = d3.svg.axis().scale(y).orient("left").ticks(0);

    let svg = d3.select("#charts")
        .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
        .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    svg.append("g")
        .attr("class", "x axis")
        .attr("transform", "translate(0," + height + ")")
        .call(xAxis)
        .selectAll("text")
        .style("text-anchor", "end")
        .attr("dx", "-.8em")
        .attr("dy", "-.55em")
        .attr("transform", "rotate(-90)" );
    svg.append("g")
        .attr("class", "y axis")
        .call(yAxis)
        .append("text")
        .attr("transform", "rotate(-90)")
        .attr("dy", ".71em")
        .style("text-anchor", "end");
    svg.append("text")
        .attr("transform", "translate(" + (width/2) + " ," + (height + margin.top + 20) + ")")
        .style("text-anchor", "middle")
        .text(title);
    svg.selectAll("bar")
        .data(data)
        .enter().append("rect")
        .style("fill", color)
        .attr("width", x.rangeBand())
        .attr("height", function(d) { return height - y(d); })
        .attr("x", function(d, i) { return x(i); })
        .attr("y", function(d) { return y(d); });
}

</script>

<section class="charts">
    <div id="charts"/>
</section>

<section class="settings">
    <div style="text-align: center">
        <h1>Select a File</h1>
        <input type="file" id="file_picker" class="modern_button" name="file_list" webkitdirectory multiple><br>
        <button type="button" onclick="return upload_selected_files()">Upload File</button><br>
    </div>
</section>

<section class="connections">
    <div style="text-align: center">
        <h1>Connected Services</h1>
        <a href="api/connect_to_strava"><img src="../images/connect_to_strava.png" width="256"></a>
    </div>
</section>

<section class="faq">
    <div>
        <h1>Frequently Asked Questions</h1>
        <ul>
            <li>How much does this cost? <p>Nothing</p>
            <li>How does it work? <p>Magic</p>
            <li>What data do you store? <p>Nothing</p>
        </ul>
    </div>
</section>

<section class="footer">
    <div>
        <h2>Copyright (c) 2021 Michael J Simms</h2>
    </div>
</section>

</body>

</html>
